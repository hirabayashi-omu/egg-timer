<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ゆで卵タイマー</title>

    <style>
        /* =========================
   基本設計
========================= */
        :root {
            --base-width: 360px;
            --brown: #5a3a1a;
            --brown-light: #d2b48c;
            --gap-x: 14px;
            --gap-y: 16px;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, sans-serif;
            background: #ffffff;
            overflow-x: hidden;
        }

        /* =========================
   全体スケーラ
========================= */
        #scaler {
            width: var(--base-width);
            margin: 0 auto;
            transform-origin: top center;
        }

        /* =========================
   タイマー
========================= */
        #timer {
            text-align: center;
            font-size: 64px;
            /* 2段階大きく */
            font-weight: 900;
            /* 太字 */
            margin: 12px 0 10px;
        }

        /* =========================
   スライダー
========================= */
        #slider-wrap {
            width: 100%;
            text-align: center;
            font-size: 18px;
            margin-bottom: 16px;
        }

        input[type="range"] {
            width: 100%;
            height: 10px;
            border-radius: 6px;
            background: var(--brown-light);
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--brown);
            cursor: pointer;
        }

        /* =========================
   パネル
========================= */
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--gap-y) var(--gap-x);
            justify-items: center;
        }

        .panel img {
            width: 160px;
            display: block;
            border-radius: 12px;
        }

        .panel.selected img {
            outline: 4px solid #ff9800;
            outline-offset: -4px;
        }

        /* =========================
   操作ボタン
========================= */
        .controls {
            display: flex;
            gap: 14px;
            margin: 20px 0;
        }

        .controls button {
            flex: 1;
            padding: 18px 0;
            font-size: 22px;
            font-weight: bold;
            background: var(--brown);
            color: #fff;
            border: none;
            border-radius: 14px;
        }

        /* =========================
   モード切替
========================= */
        .mode-switch {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            background: #fdf5e6;
            padding: 10px;
            border-radius: 20px;
            border: 2px solid var(--brown);
        }

        .mode-option {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            color: var(--brown);
        }

        .mode-option input[type="radio"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--brown);
            border-radius: 50%;
            margin-right: 8px;
            position: relative;
            cursor: pointer;
        }

        .mode-option input[type="radio"]:checked {
            background-color: var(--brown);
            box-shadow: inset 0 0 0 3px #fff;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>

    <div id="scaler">

        <div id="timer">00:00</div>

        <div id="slider-wrap">
            卵サイズ：<span id="eggLabel">55</span> mm<br>
            <input id="eggSize" type="range" min="20" max="70" value="55">
        </div>

        <!-- モード切替ラジオボタン -->
        <div class="mode-switch">
            <label class="mode-option">
                <input type="radio" name="mode" value="boiled" checked>
                95℃ (ゆで卵)
            </label>
            <label class="mode-option">
                <input type="radio" name="mode" value="onsen">
                80℃ (温泉卵)
            </label>
        </div>

        <!-- 95℃用グリッド -->
        <div id="grid-boiled" class="grid">
            <div class="panel" data-type="raw"><img src="images/01_raw.png"></div>
            <div class="panel" data-type="toro"><img src="images/02_toro.png"></div>
            <div class="panel" data-type="soft"><img src="images/03_soft.png"></div>
            <div class="panel" data-type="mid"><img src="images/04_mid.png"></div>
            <div class="panel" data-type="moist"><img src="images/05_moist.png"></div>
            <div class="panel" data-type="hard"><img src="images/06_hard.png"></div>
        </div>

        <!-- 80℃用グリッド (初期非表示) -->
        <div id="grid-onsen" class="grid hidden">
            <div class="panel" data-type="onsen_raw">
                <img src="images/07_raw.png">
            </div>
            <div class="panel" data-type="onsen_soft">
                <img src="images/08_yolkSoft.png">
            </div>
            <div class="panel" data-type="onsen_hard">
                <img src="images/09_yolkHard.png">
            </div>
            <div class="panel" data-type="onsen_done">
                <img src="images/10_onsenTamago.png">
            </div>
        </div>

        <div class="controls">
            <button id="startBtn">▶</button>
            <button id="pauseBtn">Ⅱ</button>
            <button id="stopBtn">■</button>
        </div>

    </div>

    <audio id="alarm">
        <source src="alarm.mp3" type="audio/mpeg">
    </audio>

    <script>
        /* =========================
           DOM取得
        ========================= */
        const scaler = document.getElementById("scaler");
        const timerEl = document.getElementById("timer");
        const eggSize = document.getElementById("eggSize");
        const eggLabel = document.getElementById("eggLabel");
        const alarm = document.getElementById("alarm");
        const gridBoiled = document.getElementById("grid-boiled");
        const gridOnsen = document.getElementById("grid-onsen");
        const modeRadios = document.querySelectorAll('input[name="mode"]');
        // パネルはあとで再取得するか、動的に扱うが、ここは初期化時だけ動くので
        // grid-onsen追加後に全取得するためにここで取得順序注意
        // しかし、script実行時にはHTMLは解析済みなので querySelectorAll(".panel") で全パネル取れるはず
        const panels = document.querySelectorAll(".panel");

        let currentMode = "boiled";

        /* =========================
           スケール（確実に拡大）
        ========================= */
        function applyScale() {
            const scale = window.innerWidth / 360;
            scaler.style.transform = `scale(${Math.min(scale, 1.8)})`;
        }
        window.addEventListener("resize", applyScale);
        applyScale();

        /* =========================
           状態
        ========================= */
        let initial = 0;
        let remain = 0;
        let paused = false;
        let timerId = null;

        /* =========================
           表示更新
        ========================= */
        function updateTimer(sec) {
            if (!Number.isFinite(sec)) sec = 0;
            const m = Math.floor(sec / 60);
            const s = sec % 60;
            timerEl.textContent =
                String(m).padStart(2, '0') + ":" +
                String(s).padStart(2, '0');
        }
        updateTimer(0);

        /* =========================
           スライダー
        ========================= */
        eggLabel.textContent = eggSize.value;
        eggSize.addEventListener("input", () => {
            eggLabel.textContent = eggSize.value;
        });

        /* =========================
           モード切替
        ========================= */
        modeRadios.forEach(radio => {
            radio.addEventListener("change", (e) => {
                currentMode = e.target.value;
                if (currentMode === "boiled") {
                    gridBoiled.classList.remove("hidden");
                    gridOnsen.classList.add("hidden");
                } else {
                    gridBoiled.classList.add("hidden");
                    gridOnsen.classList.remove("hidden");
                }
                stopTimer();
            });
        });

        /* =========================
           物理モデル
        ========================= */
        function calcTimesBoiled(D) {
            const tW = 16.077 * Math.exp(0.0478 * D);
            const tY = 37.818 * Math.exp(0.0448 * D);
            return {
                raw: 0.8 * tW,
                toro: tW,
                soft: tW + 0.33 * (tY - tW),
                mid: tW + 0.67 * (tY - tW),
                moist: 0.95 * tY,
                hard: 1.10 * tY
            };
        }

        function calcTimesOnsen(D) {
            const A = 4.638 * Math.exp(0.0479 * D);
            const B = 42.661 * Math.exp(0.0464 * D);
            return {
                onsen_raw: 0.85 * A,
                onsen_soft: A + 0.2 * (B - A),
                onsen_hard: A + 0.8 * (B - A),
                onsen_done: 1.15 * B
            };
        }

        /* =========================
           パネル選択
        ========================= */
        panels.forEach(p => {
            p.addEventListener("click", () => {
                const type = p.dataset.type;
                const D = Number(eggSize.value);
                let t;

                if (currentMode === "boiled") {
                    const times = calcTimesBoiled(D);
                    if (times[type] === undefined) return;
                    t = times[type];
                } else {
                    const times = calcTimesOnsen(D);
                    if (times[type] === undefined) return;
                    t = times[type];
                }

                initial = Math.floor(t);
                remain = initial;
                paused = false;

                panels.forEach(x => x.classList.remove("selected"));
                p.classList.add("selected");

                updateTimer(remain);
            });
        });


        /* =========================
           タイマー制御
        ========================= */
        function stopTimer() {
            clearInterval(timerId);
            paused = false;
            remain = initial;
            updateTimer(remain);
        }

        document.getElementById("startBtn").onclick = () => {
            if (remain <= 0) return;
            clearInterval(timerId);
            timerId = setInterval(() => {
                if (!paused && remain > 0) {
                    remain--;
                    updateTimer(remain);
                    if (remain === 0) finish();
                }
            }, 1000);
        };

        document.getElementById("pauseBtn").onclick = () => {
            paused = !paused;
        };

        document.getElementById("stopBtn").onclick = stopTimer;

        /* =========================
           完了通知
        ========================= */
        function finish() {
            alarm.play().catch(() => { });
            navigator.vibrate?.([300, 200, 300]);
        }
    </script>

</body>

</html>
