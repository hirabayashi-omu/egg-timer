<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ゆで卵タイマー</title>

<style>
:root {
    --panel-w: 180px;
    --gap-x: 12px;
    --gap-y: 12px;
    --block-w: calc(var(--panel-w) * 2 + var(--gap-x));
    --brown: #5a3a1a;
    --brown-light: #d2b48c;
}

body {
    margin: 0;
    padding: 0;
    font-family: system-ui, -apple-system, sans-serif;
    background: #ffffff;
    text-align: center;
}

/* ===== タイマー ===== */
#timer {
    width: var(--block-w);
    margin: 6px auto;
    font-size: 26px;
    font-weight: bold;
}

/* ===== スライダー ===== */
#slider-wrap {
    width: var(--block-w);
    margin: 6px auto 16px;
}
input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 8px;
    border-radius: 4px;
    background: var(--brown-light);
    outline: none;
}
input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 26px;
    height: 26px;
    border-radius: 50%;
    background: var(--brown);
}
input[type="range"]::-moz-range-thumb {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    background: var(--brown);
}

/* ===== パネル ===== */
.grid-wrap {
    display: flex;
    justify-content: center;
}
.grid {
    width: var(--block-w);
    display: grid;
    grid-template-columns: var(--panel-w) var(--panel-w);
    column-gap: var(--gap-x);
    row-gap: var(--gap-y);
}
.panel img {
    display: block;
    width: var(--panel-w);
}
.selected img {
    outline: 4px solid #ff9800;
}

/* ===== ボタン ===== */
.controls {
    width: var(--block-w);
    display: flex;
    justify-content: space-between;
    margin: 14px auto 10px;
}
.controls button {
    flex: 1;
    margin: 0 4px;
    font-size: 20px;
    padding: 14px 0;
    background: var(--brown);
    color: #fff;
    border: none;
    border-radius: 10px;
}
.controls button:active {
    opacity: 0.85;
}
</style>
</head>

<body>

<div id="timer">00:00</div>

<div id="slider-wrap">
    卵サイズ：<span id="eggLabel">55</span> mm<br>
    <input type="range" min="20" max="70" value="55" id="eggSize">
</div>

<div class="grid-wrap">
<div class="grid">
    <div class="panel" onclick="selectEgg('raw', this)">
        <img src="images/01_raw.png">
    </div>
    <div class="panel" onclick="selectEgg('toro', this)">
        <img src="images/02_toro.png">
    </div>
    <div class="panel" onclick="selectEgg('soft', this)">
        <img src="images/03_soft.png">
    </div>
    <div class="panel" onclick="selectEgg('mid', this)">
        <img src="images/04_mid.png">
    </div>
    <div class="panel" onclick="selectEgg('moist', this)">
        <img src="images/05_moist.png">
    </div>
    <div class="panel" onclick="selectEgg('hard', this)">
        <img src="images/06_hard.png">
    </div>
</div>
</div>

<div class="controls">
    <button onclick="startTimer()">▶</button>
    <button onclick="pauseTimer()">Ⅱ</button>
    <button onclick="stopTimer()">■</button>
</div>

<!-- 終了音 -->
<audio id="alarm">
    <source src="alarm.mp3" type="audio/mpeg">
</audio>

<script>
let eggSize = 55;
let remain = 0;
let timerID = null;
let paused = false;

/* ===== スライダー ===== */
const sizeSlider = document.getElementById("eggSize");
const eggLabel = document.getElementById("eggLabel");

sizeSlider.oninput = () => {
    eggSize = Number(sizeSlider.value);
    eggLabel.textContent = eggSize;
};

/* ===== 凝固モデル ===== */
function calcTimes() {
    const tWhite = 16.077 * Math.exp(0.0478 * eggSize);
    const tYolk  = 37.818 * Math.exp(0.0448 * eggSize);
    return {
        raw:   0.8 * tWhite,
        toro:  tWhite,
        soft:  tWhite + 0.33 * (tYolk - tWhite),
        mid:   tWhite + 0.67 * (tYolk - tWhite),
        moist: 0.95 * tYolk,
        hard:  1.10 * tYolk
    };
}

/* ===== 選択 ===== */
function selectEgg(type, el) {
    const times = calcTimes();
    remain = Math.floor(times[type]);
    updateTimer();

    document.querySelectorAll('.panel')
        .forEach(p => p.classList.remove('selected'));
    el.classList.add('selected');
}

/* ===== タイマー制御 ===== */
function startTimer() {
    if (remain <= 0) return;
    clearInterval(timerID);
    paused = false;
    timerID = setInterval(() => {
        if (!paused && remain > 0) {
            remain--;
            updateTimer();
            if (remain === 0) finish();
        }
    }, 1000);
}

function pauseTimer() {
    paused = !paused;
}

function stopTimer() {
    clearInterval(timerID);
    remain = 0;
    updateTimer();
}

/* ===== 終了処理 ===== */
function finish() {
    clearInterval(timerID);

    /* 音 */
    const alarm = document.getElementById("alarm");
    alarm.currentTime = 0;
    alarm.play().catch(()=>{});

    /* 振動（対応端末） */
    if (navigator.vibrate) {
        navigator.vibrate([300, 200, 300]);
    }
}

/* ===== 表示 ===== */
function updateTimer() {
    const m = String(Math.floor(remain / 60)).padStart(2, '0');
    const s = String(remain % 60).padStart(2, '0');
    document.getElementById("timer").textContent = `${m}:${s}`;
}
</script>

</body>
</html>
