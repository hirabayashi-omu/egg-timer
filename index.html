<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ゆで卵タイマー</title>

<style>
/* ===== 基準設計 ===== */
:root {
    --base-width: 360; /* 設計基準幅(px) */
    --brown: #5a3a1a;
    --brown-light: #d2b48c;
}

body {
    margin: 0;
    background: #fff;
    font-family: system-ui, -apple-system, sans-serif;
    overflow-x: hidden;
}

/* ===== スケーラ ===== */
#scaler {
    width: calc(var(--base-width) * 1px);
    transform-origin: top center;
    margin: 0 auto;
}

/* ===== タイマー ===== */
#timer {
    font-size: 56px;
    font-weight: 900;
    text-align: center;
    margin: 12px 0 6px;
}

/* ===== スライダー ===== */
#slider-wrap {
    text-align: center;
    margin-bottom: 18px;
    font-size: 18px;
}

input[type="range"] {
    width: 100%;
    height: 10px;
    background: var(--brown-light);
    border-radius: 5px;
    -webkit-appearance: none;
}
input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--brown);
}

/* ===== パネル ===== */
.grid {
    display: grid;
    grid-template-columns: 170px 170px;
    gap: 14px;
    justify-content: center;
}

.panel img {
    width: 170px;
    display: block;
}

.selected img {
    outline: 4px solid #ff9800;
    outline-offset: -4px;
}

/* ===== ボタン ===== */
.controls {
    display: flex;
    gap: 14px;
    margin: 18px auto;
}

.controls button {
    flex: 1;
    padding: 18px 0;
    font-size: 22px;
    background: var(--brown);
    color: #fff;
    border: none;
    border-radius: 12px;
}
</style>
</head>

<body>

<div id="scaler">

<div id="timer">00:00</div>

<div id="slider-wrap">
    卵サイズ：<span id="eggLabel">55</span> mm<br>
    <input type="range" min="20" max="70" value="55" id="eggSize">
</div>

<div class="grid">
    <div class="panel" onclick="selectEgg('raw', this)"><img src="images/01_raw.png"></div>
    <div class="panel" onclick="selectEgg('toro', this)"><img src="images/02_toro.png"></div>
    <div class="panel" onclick="selectEgg('soft', this)"><img src="images/03_soft.png"></div>
    <div class="panel" onclick="selectEgg('mid', this)"><img src="images/04_mid.png"></div>
    <div class="panel" onclick="selectEgg('moist', this)"><img src="images/05_moist.png"></div>
    <div class="panel" onclick="selectEgg('hard', this)"><img src="images/06_hard.png"></div>
</div>

<div class="controls">
    <button onclick="startTimer()">▶</button>
    <button onclick="pauseTimer()">Ⅱ</button>
    <button onclick="stopTimer()">■</button>
</div>

</div>

<audio id="alarm">
    <source src="alarm.mp3" type="audio/mpeg">
</audio>

<script>
/* ===== スケール計算 ===== */
function applyScale() {
    const scale = window.innerWidth / 360;
    document.getElementById("scaler").style.transform =
        `scale(${Math.min(scale, 1.8)})`;
}
window.addEventListener("resize", applyScale);
applyScale();

/* ===== 状態 ===== */
let eggSize = 55;
let remain = 0;
let initial = 0;
let id = null;
let pause = false;

eggSize.oninput = () => {
    eggLabel.textContent = eggSize.value;
};

/* ===== 時間モデル ===== */
function calcTimes() {
    const tW = 16.077 * Math.exp(0.0478 * eggSize.value);
    const tY = 37.818 * Math.exp(0.0448 * eggSize.value);
    return {
        raw: 0.8 * tW,
        toro: tW,
        soft: tW + 0.33 * (tY - tW),
        mid: tW + 0.67 * (tY - tW),
        moist: 0.95 * tY,
        hard: 1.1 * tY
    };
}

function selectEgg(type, el) {
    const t = calcTimes();
    initial = Math.floor(t[type]);
    remain = initial;
    update();

    document.querySelectorAll('.panel')
        .forEach(p => p.classList.remove('selected'));
    el.classList.add('selected');
}

function startTimer() {
    if (remain <= 0) return;
    clearInterval(id);
    id = setInterval(() => {
        if (!pause && remain > 0) {
            remain--;
            update();
            if (remain === 0) finish();
        }
    }, 1000);
}

function pauseTimer() { pause = !pause; }

function stopTimer() {
    clearInterval(id);
    pause = false;
    remain = initial;
    update();
}

function finish() {
    document.getElementById("alarm").play().catch(()=>{});
    navigator.vibrate?.([300,200,300]);
}

function update() {
    timer.textContent =
        String(Math.floor(remain/60)).padStart(2,'0') + ":" +
        String(remain%60).padStart(2,'0');
}
</script>

</body>
</html>
